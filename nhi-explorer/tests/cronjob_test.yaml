# Test docs: https://github.com/helm-unittest/helm-unittest/blob/main/DOCUMENT.md
suite: test cronjob
templates:
  - cronjob.yaml
tests:
  - it: should work
    set:
      image.tag: latest
    asserts:
      - isKind:
          of: CronJob
      - matchRegex:
          path: metadata.name
          pattern: -nhi-explorer$
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].image
          value: ghcr.io/gitguardian/gg-nhi-explorer:latest

  - it: should set schedule
    set:
      agent.schedule: '1 * * * *'
    asserts:
      - equal:
          path: spec.schedule
          value: '1 * * * *'

  - it: should set image pull secrets
    set:
      imagePullSecrets:
        - name: foobar
    asserts:
      - equal:
          path: spec.jobTemplate.spec.template.spec.imagePullSecrets
          value:
            - name: foobar

  - it: should set resources
    set:
      resources:
        limits:
          cpu: 200m
          memory: 200m
        requests:
          cpu: 100m
          memory: 100m
    asserts:
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].resources.limits
          value:
            cpu: 200m
            memory: 200m
      - equal:
          path: spec.jobTemplate.spec.template.spec.containers[0].resources.requests
          value:
            cpu: 100m
            memory: 100m
